#calculate per pixel summary stats using cdo
#because its parallelized
NDVI_landsat_ds = NDVI_landsat.to_dataset(name='NDVI')
NDVI_landsat_ds.attrs = landsat.attrs
print("exporting NDVI netcdf")
datacube.storage.storage.write_dataset_to_netcdf(NDVI_landsat_ds, results + AOI + year + "_NDVI.nc")
print("using cdo to calculate MaxNDVI")
os.system("cdo timmax " + results + AOI + year + "_NDVI.nc" + " " + results + AOI + year + "_MaxNDVI.nc")
os.remove(results + AOI + year + "_NDVI.nc")

#import in the results and then export as Gtiff
NDVI_max = xr.open_dataset(results + AOI + year + "_MaxNDVI.nc").drop('time_bnds').squeeze()
NDVI_max = NDVI_max.NDVI.drop('time').rename('NDVI_max')

